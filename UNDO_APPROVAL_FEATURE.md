# ✨ ميزة جديدة: إلغاء الموافقة (Undo Approval)

## 🎯 المشكلة التي تحل:
- وافقت على اجتماع **بالغلط**
- الاجتماع **اختفى** من القائمة
- أريد **إلغاء الموافقة** و**تعديل البيانات**

---

## ✅ الحل الجديد:

### الميزات:
1. ✅ **إلغاء الموافقة**: العودة من `approved` إلى `pending`
2. ✅ **تعديل البيانات**: الآن يمكنك إعادة تعديل الاجتماع
3. ✅ **إعادة الموافقة**: بعد التعديل توافق مرة تانية

---

## 🛠️ كيف تستخدمه:

### 1️⃣ في الواجهة (UI)
سيظهر زر **"إلغاء الموافقة"** في صفحة الاجتماع المعتمد:
```
[✅ موافق عليه] ← اضغط للعودة
   ↓
[⏳ في انتظار الموافقة] ← الحالة الجديدة
```

### 2️⃣ عبر API
```bash
POST /meetings/{meeting_id}/undo-approval
```

### 3️⃣ من الكود
```php
$meeting->undo(); // إذا أضفنا method في Model
```

---

## 📋 ما الذي يحدث:

### عند الضغط على "إلغاء الموافقة":

**قبل:**
```php
approval_status = 'approved'
approved_by = 5  // Technical Support
approved_at = 2024-10-17 15:30:00
approval_notes = "موافقة"
```

**بعد:**
```php
approval_status = 'pending'  ← عاد للمعلق
approved_by = null           ← مسح المعتمد
approved_at = null           ← مسح التاريخ
approval_notes = null        ← مسح الملاحظات
```

---

## 🔒 الشروط:

1. ✅ **يجب تكون Technical Support** (فقط TS يقدر يلغي)
2. ✅ **اجتماع عميل فقط** (ما يمكن في داخلي)
3. ✅ **approved أو auto_approved** (ما في pending أو rejected)

---

## 🚀 الاستخدام العملي:

### الخطوات:
1. **TS يفتح الاجتماع المعتمد**
2. **يضغط "إلغاء الموافقة"** (زر جديد)
3. **الاجتماع يرجع لـ pending**
4. **يقدر يعدل الوقت/البيانات**
5. **يوافق مرة تانية**

---

## 📲 في الواجهة:

```html
<!-- صفحة الاجتماع (show.blade.php) -->

@if($meeting->type === 'client' && $meeting->approval_status === 'approved')
    <form action="{{ route('meetings.undo-approval', $meeting) }}" method="POST">
        @csrf
        <button type="submit" class="btn btn-warning">
            ⚠️ إلغاء الموافقة
        </button>
    </form>
@endif
```

---

## ⚠️ ملاحظات مهمة:

- **لا يمكن إلغاء** اجتماعات `rejected`
- **لا يمكن إلغاء** اجتماعات `pending` (ما موافق عليها أصلاً)
- **فقط Technical Support** يقدر يلغي
- **البيانات القديمة** تُمسح عند الإلغاء

---

## 🔄 رسم العملية:

```
الاجتماع: auto_approved
    ↓
[موافقة بالغلط]
    ↓
approved
    ↓
[اضغط: إلغاء الموافقة]
    ↓
pending (رجع للأول)
    ↓
[عدّل البيانات]
    ↓
[وافق مرة تانية]
    ↓
approved (موافق صح)
```

---

## ✨ النتيجة:

✅ توقفت مشكلة "وافقت بالغلط"
✅ قدرت أعدل البيانات
✅ وافقت بالصح الآن

